---
title: "COVID State Web Scraping"
output: html_document
---

# Set Up

```{r, message = FALSE, warning = FALSE }
library(tidyverse)
library(pdftools)
library(rvest)
library(lubridate)
library(readxl)
source("states.R")
source("states_constants.R")
```

# Automated States

- Oklahoma: needs demographic and ages manually entered
- Mississippi: needs age and sex manually entered
- Florida: no manual entry needed, expect long compilation
- Tennessee: no manual entry needed, but needs a date input to function
- North Carolina: needs age manually entered
- District of Columbia: no data on age available
- South Carolina: needs age and sex manually entered
- New Jersey
- New Hampshire
- Guam: no age, sex, race or ethnicity data available

## Troubleshoot States Before Compiling

```{r}
# Check with these first to make sure all states have good data
florida = get_florida("../pdfs/florida_20200526.pdf")
tennessee = get_tennessee()
new_jersey = get_new_jersey()
new_hampshire = get_new_hampshire()
dc = get_dc()

# Some manual data entry
oklahoma = get_oklahoma()
mississippi = get_mississippi()
```

```{r}

```

# Compile The Automated States

```{r}
# Get as much automated data as you can
automated_data_20200526 = bind_rows(
  oklahoma,
  mississippi,
  florida,
  tennessee,
  new_jersey,
  new_hampshire,
  dc)
```

# Manual States

In addition to the information above, we need manual entry for:

- Arizona
- Hawaii
- Idaho
- Iowa
- Kansas (can automate but reading pdf crashes my RStudio?)
- Nevada: no race information
- New York: no demographic information at all
- South Dakota: have to calculate race counts from case total
- South Carolina
- West Virginia
- Wyoming

For each of these states, we'll collect sex, age, and race information.

```{r}
# All the states we do complete manual data entry for
south_carolina = get_south_carolina()
arizona = get_arizona() 
kansas = get_kansas()
iowa = get_iowa()
north_carolina = get_north_carolina()
hawaii = get_hawaii()
idaho = get_idaho()
nevada = get_nevada() 
new_york = get_new_york()
south_dakota = get_south_dakota() # Gloria
west_virginia = get_west_virginia() # Gloria 
wyoming = get_wyoming() # Amy

manual_data_20200526 = bind_rows(
  arizona,
  iowa,
  kansas,
  north_carolina,
  south_carolina,
  hawaii,
  idaho,
  nevada,
  new_york,
  south_dakota,
  west_virginia,
  wyoming
  )
```

```{r}
save(manual_data_20200526, file = "../data/raw_states/manual_2020-05-26-cbp.rda")
# load("../data/raw_states/manual_2020-05-23-cbp.rda")
full_data_20200526 = bind_rows(automated_data_20200526, manual_data_20200526)


save(full_data_20200526, file = "../data/raw_states/meta_2020-05-26-cbp.rda")
```
