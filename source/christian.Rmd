---
title: "COVID State Web Scraping"
output: html_document
---

# Set Up

```{r, message = FALSE, warning = FALSE }
library(tidyverse)
library(pdftools)
library(rvest)
library(lubridate)
library(readxl)
library(jsonlite)
source("states.R")
source("states_constants.R")
```

# Automated States

- Oklahoma: needs demographic and ages manually entered
- Mississippi: needs age and sex manually entered
- Florida: no manual entry needed, expect long compilation
- Tennessee: no manual entry needed, but needs a date input to function
- North Carolina: needs age manually entered
- District of Columbia: no data on age available
- South Carolina: needs age and sex manually entered
- New Jersey
- New Hampshire
- Guam: no age, sex, race or ethnicity data available

## Troubleshoot States Before Compiling

```{r}
browseURL("https://coronavirus.health.ok.gov/") # OK
browseURL("https://www.nj.gov/health/cd/documents/topics/NCOV/COVID_Confirmed_Case_Summary.pdf") # NJ
browseURL("https://msdh.ms.gov/msdhsite/_static/14,0,420.html") #MS
browseURL("https://scdhec.gov/infectious-diseases/viruses/coronavirus-disease-2019-covid-19/sc-testing-data-projections-covid-19") # SC
browseURL("https://public.tableau.com/profile/idaho.division.of.public.health#!/vizhome/DPHIdahoCOVID-19Dashboard_V2/Story1") # ID
```


```{r}
# Check with these first to make sure all states have good data
# https://www.floridadisaster.org/covid19/covid-19-data-reports/
florida = get_florida()
oklahoma = get_oklahoma()
new_jersey = get_new_jersey()
mississippi = get_mississippi()
tennessee = get_tennessee("2020-06-29")
south_carolina = get_south_carolina()
idaho = get_idaho()
minnesota = get_minnesota()

# north_carolina = get_north_carolina() # Given away
# new_hampshire = get_new_hampshire() # Given away
# kansas = get_kansas() # Given away
# iowa = get_iowa() # Given away
# arizona = get_arizona() # Given away
# hawaii = get_hawaii() # Given away
```

```{r}
full_data_20200622 = bind_rows(
  florida,
  oklahoma,
  mississippi,
  new_jersey,
  tennessee,
  south_carolina,
  idaho,
  minnesota)
```

```{r}
save(full_data_20200622, file ="../data/raw_states/meta_2020-06-22-cbp.rda")
```



